<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>主播名字整合器 - 顿号支持版</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            border-bottom: 2px solid #0f3460;
        }
        
        h1 {
            color: #4cc9f0;
            margin-bottom: 10px;
            font-size: 2.5rem;
            text-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }
        
        .subtitle {
            color: #a9b7c6;
            font-size: 1.1rem;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 1100px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
        
        .input-section {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .output-section {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .section-title {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            color: #4cc9f0;
            font-size: 1.4rem;
        }
        
        .section-title i {
            margin-right: 10px;
        }
        
        .input-area, .output-area {
            width: 100%;
            min-height: 150px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid #0f3460;
            border-radius: 8px;
            color: #e0e0e0;
            font-size: 1rem;
            resize: vertical;
            margin-bottom: 15px;
            transition: border 0.3s;
            white-space: pre-wrap;
            word-wrap: break-word;
            line-height: 1.6;
        }
        
        .input-area:focus, .output-area:focus {
            outline: none;
            border-color: #4cc9f0;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 10px;
        }
        
        @media (max-width: 768px) {
            .stats {
                grid-template-columns: 1fr;
            }
        }
        
        .stat-item {
            text-align: center;
            padding: 10px 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #a9b7c6;
            margin-bottom: 5px;
        }
        
        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #4cc9f0;
        }
        
        .action-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 20px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: #4361ee;
            color: white;
        }
        
        .btn-primary:hover {
            background: #3a56d4;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: #7209b7;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #5e0a99;
            transform: translateY(-2px);
        }
        
        .btn-success {
            background: #2ec4b6;
            color: white;
        }
        
        .btn-success:hover {
            background: #28a99e;
            transform: translateY(-2px);
        }
        
        .btn-danger {
            background: #e63946;
            color: white;
        }
        
        .btn-danger:hover {
            background: #d32f3c;
            transform: translateY(-2px);
        }
        
        /* 改进的紧凑结果容器 */
        .result-container {
            min-height: 200px;
            max-height: 400px;
            overflow-y: auto;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            border: 1px solid #0f3460;
            margin-bottom: 15px;
        }
        
        /* 紧凑显示模式 */
        .compact-results {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .compact-item {
            display: inline-flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.07);
            border-radius: 6px;
            padding: 6px 10px;
            margin: 2px;
            border-left: 3px solid #4cc9f0;
            transition: all 0.2s;
            max-width: 100%;
            box-sizing: border-box;
        }
        
        .compact-item:hover {
            background: rgba(255, 255, 255, 0.12);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .compact-item.deleted {
            opacity: 0.5;
            border-left-color: #e63946;
            text-decoration: line-through;
        }
        
        .compact-name {
            font-size: 0.95rem;
            margin-right: 6px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 200px;
        }
        
        .compact-actions {
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .compact-btn {
            background: transparent;
            border: none;
            color: #a9b7c6;
            cursor: pointer;
            font-size: 0.8rem;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            padding: 0;
        }
        
        .compact-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .compact-btn.delete:hover {
            color: #e63946;
        }
        
        .compact-btn.undo:hover {
            color: #2ec4b6;
        }
        
        .empty-state {
            text-align: center;
            padding: 30px;
            color: #a9b7c6;
            font-style: italic;
        }
        
        .history-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .history-title {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            color: #4cc9f0;
            font-size: 1.2rem;
        }
        
        .history-list {
            max-height: 150px;
            overflow-y: auto;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            margin-bottom: 15px;
        }
        
        .history-item {
            padding: 8px 12px;
            margin-bottom: 5px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
            font-size: 0.9rem;
            border-left: 3px solid #7209b7;
        }
        
        .divider {
            height: 1px;
            background: linear-gradient(to right, transparent, #0f3460, transparent);
            margin: 20px 0;
        }
        
        .copy-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #2ec4b6;
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            opacity: 0;
            transform: translateY(-20px);
            transition: all 0.3s;
        }
        
        .copy-notification.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        .output-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .output-actions {
            display: flex;
            gap: 10px;
        }
        
        .file-input {
            display: none;
        }
        
        .file-label {
            display: inline-block;
            cursor: pointer;
        }
        
        .highlight {
            animation: highlight 1.5s ease;
        }
        
        @keyframes highlight {
            0% { background-color: rgba(76, 201, 240, 0.3); }
            100% { background-color: transparent; }
        }
        
        .sync-badge {
            display: inline-block;
            background: #2ec4b6;
            color: white;
            font-size: 0.7rem;
            padding: 2px 8px;
            border-radius: 10px;
            margin-left: 10px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 0.7; }
            50% { opacity: 1; }
            100% { opacity: 0.7; }
        }
        
        .format-info {
            display: flex;
            align-items: center;
            margin-top: 10px;
            padding: 8px 12px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 6px;
            font-size: 0.85rem;
            color: #a9b7c6;
        }
        
        .format-info i {
            margin-right: 8px;
            color: #4cc9f0;
        }
        
        .delimiter-badge {
            display: inline-block;
            background: #7209b7;
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.75rem;
            margin: 0 3px;
        }
        
        .format-example {
            font-style: italic;
            color: #8b9dc3;
            font-size: 0.9rem;
            margin-top: 5px;
        }
        
        /* 显示模式切换 */
        .display-toggle {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 10px;
        }
        
        .display-btn {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid #0f3460;
            color: #a9b7c6;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.2s;
        }
        
        .display-btn:hover {
            background: rgba(76, 201, 240, 0.2);
            color: #4cc9f0;
        }
        
        .display-btn.active {
            background: rgba(76, 201, 240, 0.3);
            color: #4cc9f0;
            border-color: #4cc9f0;
        }
        
        .display-btn:first-child {
            border-top-right-radius: 0;
            border-bottom-right-radius: 0;
        }
        
        .display-btn:last-child {
            border-top-left-radius: 0;
            border-bottom-left-radius: 0;
        }
        
        /* 网格显示模式 */
        .grid-results {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 10px;
        }
        
        .grid-item {
            background: rgba(255, 255, 255, 0.07);
            border-radius: 8px;
            padding: 10px;
            border-left: 4px solid #4cc9f0;
            transition: all 0.2s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .grid-item:hover {
            background: rgba(255, 255, 255, 0.12);
            transform: translateY(-2px);
        }
        
        .grid-item.deleted {
            opacity: 0.5;
            border-left-color: #e63946;
            text-decoration: line-through;
        }
        
        .grid-name {
            font-size: 1rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 140px;
        }
        
        /* 列表显示模式（原始） */
        .list-results {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(255, 255, 255, 0.07);
            border-radius: 8px;
            padding: 10px 15px;
            border-left: 4px solid #4cc9f0;
            transition: all 0.2s;
        }
        
        .list-item:hover {
            background: rgba(255, 255, 255, 0.12);
        }
        
        .list-item.deleted {
            opacity: 0.5;
            border-left-color: #e63946;
            text-decoration: line-through;
        }
        
        .list-name {
            font-size: 1rem;
            flex-grow: 1;
        }
        
        .list-actions {
            display: flex;
            gap: 8px;
        }
        
        /* 删除的主播列表 */
        .deleted-section {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .deleted-title {
            font-size: 0.9rem;
            color: #a9b7c6;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .deleted-items {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }
        
        .deleted-item {
            display: inline-flex;
            align-items: center;
            background: rgba(230, 57, 70, 0.1);
            border-radius: 6px;
            padding: 4px 8px;
            font-size: 0.85rem;
            color: #e63946;
            border: 1px solid rgba(230, 57, 70, 0.3);
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .deleted-item:hover {
            background: rgba(230, 57, 70, 0.2);
            transform: translateY(-1px);
        }
        
        .no-deleted {
            font-style: italic;
            color: #a9b7c6;
            font-size: 0.9rem;
            text-align: center;
            padding: 10px;
        }
        
        .parsing-info {
            background: rgba(255, 193, 7, 0.1);
            border: 1px solid rgba(255, 193, 7, 0.3);
            border-radius: 6px;
            padding: 10px 15px;
            margin-top: 10px;
            font-size: 0.85rem;
            color: #ffc107;
        }
        
        .parsing-info i {
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-users"></i> 主播名字整合器 - 顿号支持版</h1>
            <p class="subtitle">输入主播名单，支持顿号、逗号、换行、空格等多种分隔符，紧凑显示交互列表</p>
        </header>
        
        <div class="main-content">
            <div class="input-section">
                <div class="section-title">
                    <i class="fas fa-edit"></i> 输入主播名单
                </div>
                
                <div class="stats">
                    <div class="stat-item">
                        <div class="stat-label">名单1人数</div>
                        <div id="count1" class="stat-value">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">名单2人数</div>
                        <div id="count2" class="stat-value">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">重复人数</div>
                        <div id="duplicateCount" class="stat-value">0</div>
                    </div>
                </div>
                
                <div class="input-group">
                    <label for="list1">名单1 (支持顿号、逗号、换行、空格分隔)</label>
                    <textarea id="list1" class="input-area" placeholder="例如: 
张三、李四、王五
赵六，小美，阿强
小明、小红"></textarea>
                </div>
                
                <div class="format-info">
                    <i class="fas fa-info-circle"></i>
                    支持分隔符: <span class="delimiter-badge">、</span> (顿号) <span class="delimiter-badge">，</span> (中文逗号) <span class="delimiter-badge">,</span> (英文逗号) <span class="delimiter-badge">空格</span> <span class="delimiter-badge">换行</span>
                </div>
                
                <div class="input-group">
                    <label for="list2">名单2 (支持顿号、逗号、换行、空格分隔)</label>
                    <textarea id="list2" class="input-area" placeholder="例如: 
王五，赵六、孙七，
钱八、小美、大刘
老张、小红，小刚"></textarea>
                </div>
                
                <div id="parsingInfo1" class="parsing-info" style="display: none;">
                    <i class="fas fa-exclamation-triangle"></i>
                    <span id="parsingInfoText1"></span>
                </div>
                
                <div class="action-buttons">
                    <button id="integrateBtn" class="btn btn-primary">
                        <i class="fas fa-sync-alt"></i> 整合名单
                    </button>
                    <button id="clearBtn" class="btn btn-danger">
                        <i class="fas fa-trash"></i> 清空名单
                    </button>
                    <button id="detectFormatBtn" class="btn btn-secondary">
                        <i class="fas fa-search"></i> 检测格式
                    </button>
                </div>
            </div>
            
            <div class="output-section">
                <div class="section-title">
                    <i class="fas fa-file-alt"></i> 整合输出文本 <span class="sync-badge">保持排版</span>
                </div>
                
                <div class="output-header">
                    <div class="stats">
                        <div class="stat-item">
                            <div class="stat-label">整合后人数</div>
                            <div id="integratedCount" class="stat-value">0</div>
                        </div>
                    </div>
                    <div class="output-actions">
                        <button id="copyOutputBtn" class="icon-btn copy" title="复制整合文本">
                            <i class="fas fa-copy"></i>
                        </button>
                        <button id="updateFromOutputBtn" class="btn btn-secondary" style="padding: 8px 15px;">
                            <i class="fas fa-redo"></i> 同步到列表
                        </button>
                    </div>
                </div>
                
                <textarea id="integratedOutput" class="output-area" placeholder="整合后的主播名单将显示在这里，完全保持原始排版格式，包括换行和空格"></textarea>
                
                <div class="format-info">
                    <i class="fas fa-clipboard-check"></i>
                    保持原始排版格式，包括: <span class="delimiter-badge">换行</span> <span class="delimiter-badge">空格</span> <span class="delimiter-badge">逗号类型</span> <span class="delimiter-badge">顿号</span>
                </div>
                
                <div class="action-buttons">
                    <button id="exportOutputBtn" class="btn btn-success">
                        <i class="fas fa-file-export"></i> 导出整合文本
                    </button>
                    <label for="importOutputFile" class="btn btn-secondary file-label">
                        <i class="fas fa-file-import"></i> 导入整合文本
                    </label>
                    <input type="file" id="importOutputFile" class="file-input" accept=".txt">
                    <button id="formatOutputBtn" class="btn btn-secondary">
                        <i class="fas fa-align-left"></i> 美化格式
                    </button>
                </div>
            </div>
            
            <div class="output-section">
                <div class="section-title">
                    <i class="fas fa-list-alt"></i> 交互式结果列表
                </div>
                
                <div class="stats">
                    <div class="stat-item">
                        <div class="stat-label">列表人数</div>
                        <div id="listCount" class="stat-value">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">已删除</div>
                        <div id="deletedCount" class="stat-value">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">历史操作</div>
                        <div id="historyCount" class="stat-value">0</div>
                    </div>
                </div>
                
                <div class="display-toggle">
                    <div class="display-buttons">
                        <button id="compactDisplayBtn" class="display-btn active" title="紧凑显示">
                            <i class="fas fa-grip-horizontal"></i> 紧凑
                        </button>
                        <button id="gridDisplayBtn" class="display-btn" title="网格显示">
                            <i class="fas fa-th"></i> 网格
                        </button>
                        <button id="listDisplayBtn" class="display-btn" title="列表显示">
                            <i class="fas fa-list"></i> 列表
                        </button>
                    </div>
                </div>
                
                <div id="resultContainer" class="result-container">
                    <div class="empty-state">
                        <i class="fas fa-clipboard-list fa-2x" style="margin-bottom: 10px;"></i>
                        <p>交互式列表将显示在这里</p>
                    </div>
                </div>
                
                <div class="deleted-section">
                    <div class="deleted-title">
                        <span>已删除的主播 (点击恢复)</span>
                        <span id="deletedItemsCount">0 个</span>
                    </div>
                    <div id="deletedItemsContainer" class="deleted-items">
                        <div class="no-deleted">暂无已删除的主播</div>
                    </div>
                </div>
                
                <div class="action-buttons">
                    <button id="undoBtn" class="btn btn-secondary">
                        <i class="fas fa-undo"></i> 撤回删除
                    </button>
                    <button id="clearResultsBtn" class="btn btn-danger">
                        <i class="fas fa-broom"></i> 清空列表
                    </button>
                    <button id="syncToOutputBtn" class="btn btn-primary">
                        <i class="fas fa-sync"></i> 同步到输出
                    </button>
                </div>
            </div>
            
            <div class="output-section">
                <div class="section-title">
                    <i class="fas fa-history"></i> 操作历史
                </div>
                
                <div id="historyList" class="history-list">
                    <div class="empty-state">
                        <i class="fas fa-history fa-lg" style="margin-bottom: 10px;"></i>
                        <p>操作历史将显示在这里</p>
                    </div>
                </div>
                
                <div class="action-buttons">
                    <button id="clearHistoryBtn" class="btn btn-danger">
                        <i class="fas fa-trash"></i> 清空历史
                    </button>
                    <button id="exportHistoryBtn" class="btn btn-success">
                        <i class="fas fa-download"></i> 导出历史
                    </button>
                </div>
            </div>
        </div>
        
        <div class="divider"></div>
        
        <footer>
            <p>主播名字整合器 顿号支持版 &copy; 2023 | 使用说明: 输入主播名单后点击"整合名单"，支持顿号、逗号、换行、空格等多种分隔符</p>
            <p class="format-example">注意: 现在完整支持顿号（、）分隔符，解决多个名字连在一起的问题</p>
        </footer>
        
        <div id="copyNotification" class="copy-notification">
            <i class="fas fa-check"></i> 文本已复制到剪贴板
        </div>
    </div>

    <script>
        // 数据状态
        const state = {
            list1: [],
            list2: [],
            duplicates: [],
            integratedList: [],
            deleted: [],
            history: [],
            originalFormat1: null,
            originalFormat2: null,
            displayMode: 'compact',
            parsingErrors: []
        };
        
        // DOM元素
        const list1Input = document.getElementById('list1');
        const list2Input = document.getElementById('list2');
        const integratedOutput = document.getElementById('integratedOutput');
        const count1Element = document.getElementById('count1');
        const count2Element = document.getElementById('count2');
        const duplicateCountElement = document.getElementById('duplicateCount');
        const integratedCountElement = document.getElementById('integratedCount');
        const listCountElement = document.getElementById('listCount');
        const deletedCountElement = document.getElementById('deletedCount');
        const historyCountElement = document.getElementById('historyCount');
        const resultContainer = document.getElementById('resultContainer');
        const deletedItemsContainer = document.getElementById('deletedItemsContainer');
        const deletedItemsCount = document.getElementById('deletedItemsCount');
        const historyList = document.getElementById('historyList');
        const copyNotification = document.getElementById('copyNotification');
        const parsingInfo1 = document.getElementById('parsingInfo1');
        const parsingInfoText1 = document.getElementById('parsingInfoText1');
        
        // 按钮元素
        const integrateBtn = document.getElementById('integrateBtn');
        const clearBtn = document.getElementById('clearBtn');
        const detectFormatBtn = document.getElementById('detectFormatBtn');
        const copyOutputBtn = document.getElementById('copyOutputBtn');
        const updateFromOutputBtn = document.getElementById('updateFromOutputBtn');
        const exportOutputBtn = document.getElementById('exportOutputBtn');
        const importOutputFile = document.getElementById('importOutputFile');
        const formatOutputBtn = document.getElementById('formatOutputBtn');
        const undoBtn = document.getElementById('undoBtn');
        const clearResultsBtn = document.getElementById('clearResultsBtn');
        const syncToOutputBtn = document.getElementById('syncToOutputBtn');
        const clearHistoryBtn = document.getElementById('clearHistoryBtn');
        const exportHistoryBtn = document.getElementById('exportHistoryBtn');
        
        // 显示模式按钮
        const compactDisplayBtn = document.getElementById('compactDisplayBtn');
        const gridDisplayBtn = document.getElementById('gridDisplayBtn');
        const listDisplayBtn = document.getElementById('listDisplayBtn');
        
        // 初始化
        function init() {
            // 设置默认示例数据（包含多种分隔符和排版，包括顿号）
            list1Input.value = `张三、李四、王五
赵六，小美，阿强
小明、小红`;

            list2Input.value = `王五，赵六、孙七，
钱八、小美、大刘
老张、小红，小刚`;
            
            // 绑定事件
            list1Input.addEventListener('input', updateCounts);
            list2Input.addEventListener('input', updateCounts);
            integratedOutput.addEventListener('input', updateIntegratedCount);
            
            integrateBtn.addEventListener('click', integrateLists);
            clearBtn.addEventListener('click', clearAll);
            detectFormatBtn.addEventListener('click', detectFormats);
            copyOutputBtn.addEventListener('click', copyIntegratedOutput);
            updateFromOutputBtn.addEventListener('click', updateListFromOutput);
            exportOutputBtn.addEventListener('click', exportIntegratedOutput);
            importOutputFile.addEventListener('change', importIntegratedOutput);
            formatOutputBtn.addEventListener('click', formatOutput);
            undoBtn.addEventListener('click', undoDelete);
            clearResultsBtn.addEventListener('click', clearResults);
            syncToOutputBtn.addEventListener('click', syncOutputFromList);
            clearHistoryBtn.addEventListener('click', clearHistory);
            exportHistoryBtn.addEventListener('click', exportHistory);
            
            // 显示模式切换
            compactDisplayBtn.addEventListener('click', () => setDisplayMode('compact'));
            gridDisplayBtn.addEventListener('click', () => setDisplayMode('grid'));
            listDisplayBtn.addEventListener('click', () => setDisplayMode('list'));
            
            // 初始更新
            updateCounts();
            integrateLists();
            
            // 显示初始提示
            addHistory('应用已初始化，可以开始使用');
        }
        
        // 设置显示模式
        function setDisplayMode(mode) {
            state.displayMode = mode;
            
            // 更新按钮状态
            compactDisplayBtn.classList.toggle('active', mode === 'compact');
            gridDisplayBtn.classList.toggle('active', mode === 'grid');
            listDisplayBtn.classList.toggle('active', mode === 'list');
            
            // 更新显示
            updateResultList();
        }
        
        // 更新计数
        function updateCounts() {
            const list1Result = parseNamesWithFormat(list1Input.value);
            const list2Result = parseNamesWithFormat(list2Input.value);
            
            state.list1 = list1Result.names;
            state.originalFormat1 = list1Result.formatInfo;
            state.list2 = list2Result.names;
            state.originalFormat2 = list2Result.formatInfo;
            
            // 显示解析错误信息
            if (list1Result.parsingError) {
                parsingInfo1.style.display = 'block';
                parsingInfoText1.textContent = list1Result.parsingError;
            } else {
                parsingInfo1.style.display = 'none';
            }
            
            // 计算重复项
            state.duplicates = findDuplicates(state.list1, state.list2);
            
            count1Element.textContent = state.list1.length;
            count2Element.textContent = state.list2.length;
            duplicateCountElement.textContent = state.duplicates.length;
        }
        
        // 更新整合输出计数
        function updateIntegratedCount() {
            const result = parseNamesWithFormat(integratedOutput.value);
            integratedCountElement.textContent = result.names.length;
        }
        
        // 解析名字列表并保留格式信息
        function parseNamesWithFormat(input) {
            if (!input || input.trim() === '') {
                return { 
                    names: [], 
                    formatInfo: null,
                    parsingError: null
                };
            }
            
            // 保存原始文本
            const originalText = input;
            
            // 分析分隔符类型
            const formatInfo = analyzeFormat(input);
            
            // 提取名字（保持多种分隔符支持）
            const { names, parsingError } = extractNames(input, formatInfo);
            
            return {
                names: names,
                formatInfo: formatInfo,
                originalText: originalText,
                parsingError: parsingError
            };
        }
        
        // 分析文本格式
        function analyzeFormat(text) {
            const formatInfo = {
                hasChineseComma: false,
                hasEnglishComma: false,
                hasPauseMark: false, // 顿号
                hasNewline: false,
                hasSpace: false,
                primaryDelimiter: '，',
                lineEnding: '\n',
                indentPattern: null,
                trailingSpaces: false
            };
            
            // 检测中文逗号
            if (text.includes('，')) {
                formatInfo.hasChineseComma = true;
                formatInfo.primaryDelimiter = '，';
            }
            
            // 检测英文逗号
            if (text.includes(',')) {
                formatInfo.hasEnglishComma = true;
                if (!formatInfo.hasChineseComma) {
                    formatInfo.primaryDelimiter = ',';
                }
            }
            
            // 检测顿号
            if (text.includes('、')) {
                formatInfo.hasPauseMark = true;
                if (!formatInfo.hasChineseComma && !formatInfo.hasEnglishComma) {
                    formatInfo.primaryDelimiter = '、';
                }
            }
            
            // 检测换行
            if (text.includes('\n')) {
                formatInfo.hasNewline = true;
            }
            
            // 检测空格（作为分隔符）
            const lines = text.split('\n');
            let spaceAsDelimiter = false;
            for (const line of lines) {
                const trimmedLine = line.trim();
                // 检查是否有用空格分隔的名字，且不包含其他分隔符
                if (trimmedLine.includes(' ') && 
                    !trimmedLine.includes('，') && 
                    !trimmedLine.includes(',') && 
                    !trimmedLine.includes('、')) {
                    const parts = trimmedLine.split(' ').filter(part => part.trim() !== '');
                    if (parts.length > 1) {
                        spaceAsDelimiter = true;
                        break;
                    }
                }
            }
            formatInfo.hasSpace = spaceAsDelimiter;
            
            // 检测行尾是否有空格
            formatInfo.trailingSpaces = /\s+$/.test(text);
            
            return formatInfo;
        }
        
        // 提取名字（支持多种分隔符）
        function extractNames(text, formatInfo) {
            const lines = text.split('\n');
            const names = [];
            let parsingError = null;
            
            for (const line of lines) {
                if (line.trim() === '') continue;
                
                let lineNames = [];
                
                // 根据检测到的分隔符分割行
                // 优先使用主要分隔符，如果检测到多种分隔符，则使用正则表达式分割
                if (formatInfo.hasChineseComma || formatInfo.hasEnglishComma || formatInfo.hasPauseMark) {
                    // 使用正则表达式分割多种分隔符
                    const delimiterRegex = /[，,、\s]+/; // 逗号、顿号、空格
                    lineNames = line.split(delimiterRegex).map(name => name.trim()).filter(name => name !== '');
                } else if (formatInfo.hasSpace) {
                    lineNames = line.split(' ').map(name => name.trim()).filter(name => name !== '');
                } else {
                    // 没有分隔符，整行作为一个名字
                    if (line.trim() !== '') {
                        lineNames = [line.trim()];
                    }
                }
                
                // 检查是否有名字连在一起的情况（没有用分隔符分隔）
                for (let i = 0; i < lineNames.length; i++) {
                    const name = lineNames[i];
                    // 检查名字是否过长或包含不常见字符（可能是多个名字连在一起）
                    if (name.length > 10 && !parsingError) {
                        // 检查是否包含常见的中文姓氏或名字
                        const commonSurnames = ['张', '李', '王', '赵', '刘', '陈', '杨', '黄', '周', '吴'];
                        let hasCommonSurname = false;
                        for (const surname of commonSurnames) {
                            if (name.includes(surname)) {
                                hasCommonSurname = true;
                                break;
                            }
                        }
                        
                        if (!hasCommonSurname) {
                            parsingError = `发现可能未正确分隔的名字: "${name}"，请检查分隔符使用是否正确`;
                        }
                    }
                }
                
                names.push(...lineNames);
            }
            
            return { names, parsingError };
        }
        
        // 查找重复项
        function findDuplicates(list1, list2) {
            const set1 = new Set(list1);
            const duplicates = [];
            
            for (const name of list2) {
                if (set1.has(name)) {
                    duplicates.push(name);
                }
            }
            
            return [...new Set(duplicates)];
        }
        
        // 整合名单（保持排版）
        function integrateLists() {
            const list1Result = parseNamesWithFormat(list1Input.value);
            const list2Result = parseNamesWithFormat(list2Input.value);
            
            state.list1 = list1Result.names;
            state.list2 = list2Result.names;
            state.originalFormat1 = list1Result.formatInfo;
            state.originalFormat2 = list2Result.formatInfo;
            
            // 找出list2中不在list1中的名字
            const set1 = new Set(state.list1);
            const newNames = state.list2.filter(name => !set1.has(name));
            
            // 构建整合后的文本（保持list1的排版）
            let integratedText = list1Input.value;
            
            if (newNames.length === 0) {
                integratedOutput.value = integratedText;
                state.integratedList = [...state.list1];
            } else {
                // 添加新名字到list1的尾部，保持排版格式
                integratedText = addNamesWithFormat(integratedText, newNames, list1Result.formatInfo);
                integratedOutput.value = integratedText;
                
                // 更新整合列表
                const integratedResult = parseNamesWithFormat(integratedText);
                state.integratedList = integratedResult.names;
            }
            
            // 更新交互式列表
            updateResultList();
            
            // 更新计数
            updateAllCounts();
            
            // 记录历史
            addHistory(`整合名单，共 ${state.integratedList.length} 个主播（新增 ${newNames.length} 个）`);
            
            // 高亮显示输出区域
            integratedOutput.classList.add('highlight');
            setTimeout(() => integratedOutput.classList.remove('highlight'), 1500);
        }
        
        // 按照格式添加新名字
        function addNamesWithFormat(baseText, newNames, formatInfo) {
            if (newNames.length === 0) return baseText;
            
            let result = baseText;
            
            const trimmedBase = result.trim();
            
            let delimiter = '，';
            
            if (formatInfo) {
                delimiter = formatInfo.primaryDelimiter;
            }
            
            if (trimmedBase === '') {
                return newNames.join(delimiter);
            }
            
            const lastChar = result[result.length - 1];
            const isNewline = lastChar === '\n';
            const isDelimiter = lastChar === '，' || lastChar === ',' || lastChar === '、' || lastChar === ' ';
            
            if (isNewline) {
                result += newNames.join(delimiter);
            } else if (isDelimiter) {
                result += newNames.join(delimiter);
            } else {
                result += delimiter + newNames.join(delimiter);
            }
            
            return result;
        }
        
        // 更新交互式结果列表
        function updateResultList() {
            if (state.integratedList.length === 0) {
                resultContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-clipboard-list fa-2x" style="margin-bottom: 10px;"></i>
                        <p>交互式列表将显示在这里</p>
                    </div>
                `;
                return;
            }
            
            // 过滤已删除的项
            const displayList = state.integratedList.filter(name => !state.deleted.includes(name));
            
            // 根据显示模式生成HTML
            let resultHTML = '';
            
            if (state.displayMode === 'compact') {
                // 紧凑显示模式
                resultHTML = '<div class="compact-results">';
                displayList.forEach(name => {
                    resultHTML += `
                    <div class="compact-item" data-name="${name}">
                        <span class="compact-name" title="${name}">${name}</span>
                        <div class="compact-actions">
                            <button class="compact-btn delete" data-name="${name}" title="删除">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                    `;
                });
                resultHTML += '</div>';
            } else if (state.displayMode === 'grid') {
                // 网格显示模式
                resultHTML = '<div class="grid-results">';
                displayList.forEach(name => {
                    resultHTML += `
                    <div class="grid-item" data-name="${name}">
                        <span class="grid-name" title="${name}">${name}</span>
                        <div class="compact-actions">
                            <button class="compact-btn delete" data-name="${name}" title="删除">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                    `;
                });
                resultHTML += '</div>';
            } else {
                // 列表显示模式
                resultHTML = '<div class="list-results">';
                displayList.forEach(name => {
                    resultHTML += `
                    <div class="list-item" data-name="${name}">
                        <span class="list-name" title="${name}">${name}</span>
                        <div class="list-actions">
                            <button class="compact-btn delete" data-name="${name}" title="删除">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                    `;
                });
                resultHTML += '</div>';
            }
            
            resultContainer.innerHTML = resultHTML;
            
            // 绑定删除按钮事件
            document.querySelectorAll('.compact-btn.delete').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const name = this.getAttribute('data-name');
                    deleteName(name);
                });
            });
            
            // 更新已删除项显示
            updateDeletedItemsDisplay();
            
            listCountElement.textContent = displayList.length;
        }
        
        // 更新已删除项显示
        function updateDeletedItemsDisplay() {
            if (state.deleted.length === 0) {
                deletedItemsContainer.innerHTML = '<div class="no-deleted">暂无已删除的主播</div>';
                deletedItemsCount.textContent = '0 个';
            } else {
                let deletedHTML = '';
                state.deleted.forEach(name => {
                    deletedHTML += `
                    <div class="deleted-item" data-name="${name}" title="点击恢复 ${name}">
                        ${name}
                    </div>
                    `;
                });
                deletedItemsContainer.innerHTML = deletedHTML;
                deletedItemsCount.textContent = `${state.deleted.length} 个`;
                
                // 绑定恢复功能
                document.querySelectorAll('.deleted-item').forEach(item => {
                    item.addEventListener('click', function() {
                        const name = this.getAttribute('data-name');
                        restoreName(name);
                    });
                });
            }
        }
        
        // 删除名字
        function deleteName(name) {
            // 添加到删除列表
            state.deleted.push(name);
            
            // 更新UI
            updateResultList();
            updateDeletedCount();
            
            // 记录历史
            addHistory(`删除了主播: ${name}`);
            
            showTemporaryNotification(`已删除: ${name}`, 'info');
        }
        
        // 恢复名字
        function restoreName(name) {
            // 从删除列表中移除
            const index = state.deleted.indexOf(name);
            if (index !== -1) {
                state.deleted.splice(index, 1);
            }
            
            // 更新UI
            updateResultList();
            updateDeletedCount();
            
            // 记录历史
            addHistory(`恢复了主播: ${name}`);
            
            showTemporaryNotification(`已恢复: ${name}`, 'success');
        }
        
        // 从输出框更新列表
        function updateListFromOutput() {
            const result = parseNamesWithFormat(integratedOutput.value);
            
            // 更新整合列表
            state.integratedList = result.names;
            
            // 清空删除列表
            state.deleted = [];
            
            // 更新交互式列表
            updateResultList();
            
            // 更新计数
            updateAllCounts();
            
            // 记录历史
            addHistory(`从输出文本同步到列表，共 ${result.names.length} 个主播`);
        }
        
        // 从列表同步到输出框
        function syncOutputFromList() {
            // 获取当前显示列表（已过滤删除项）
            const displayList = state.integratedList.filter(name => !state.deleted.includes(name));
            
            if (displayList.length === 0) {
                integratedOutput.value = '';
                updateIntegratedCount();
                addHistory('列表已空，清空输出文本');
                return;
            }
            
            const currentResult = parseNamesWithFormat(integratedOutput.value);
            const formatInfo = currentResult.formatInfo || state.originalFormat1 || {
                primaryDelimiter: '，',
                hasNewline: true
            };
            
            let outputText = '';
            
            if (formatInfo.hasNewline) {
                // 每3个名字一组
                const groupSize = 3;
                for (let i = 0; i < displayList.length; i += groupSize) {
                    const group = displayList.slice(i, i + groupSize);
                    outputText += group.join(formatInfo.primaryDelimiter);
                    if (i + groupSize < displayList.length) {
                        outputText += '\n';
                    }
                }
            } else {
                outputText = displayList.join(formatInfo.primaryDelimiter);
            }
            
            integratedOutput.value = outputText;
            updateIntegratedCount();
            
            // 记录历史
            addHistory(`从列表同步到输出文本，共 ${displayList.length} 个主播`);
        }
        
        // 更新所有计数
        function updateAllCounts() {
            updateCounts();
            updateIntegratedCount();
            updateDeletedCount();
            updateHistoryCount();
            
            const displayList = state.integratedList.filter(name => !state.deleted.includes(name));
            listCountElement.textContent = displayList.length;
        }
        
        // 更新删除计数
        function updateDeletedCount() {
            deletedCountElement.textContent = state.deleted.length;
        }
        
        // 更新历史计数
        function updateHistoryCount() {
            historyCountElement.textContent = state.history.length;
        }
        
        // 添加历史记录
        function addHistory(action) {
            const timestamp = new Date().toLocaleTimeString();
            const date = new Date().toLocaleDateString();
            state.history.unshift({ action, timestamp, date });
            
            if (state.history.length > 15) {
                state.history.pop();
            }
            
            updateHistoryUI();
            updateHistoryCount();
        }
        
        // 更新历史记录UI
        function updateHistoryUI() {
            if (state.history.length === 0) {
                historyList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-history fa-lg" style="margin-bottom: 10px;"></i>
                        <p>操作历史将显示在这里</p>
                    </div>
                `;
                return;
            }
            
            const historyHTML = state.history.map(record => `
                <div class="history-item">
                    <div>${record.action}</div>
                    <div style="color: #a9b7c6; font-size: 0.8rem; margin-top: 5px;">
                        ${record.date} ${record.timestamp}
                    </div>
                </div>
            `).join('');
            
            historyList.innerHTML = historyHTML;
        }
        
        // 撤回删除
        function undoDelete() {
            if (state.deleted.length === 0) {
                showTemporaryNotification('没有可以撤回的删除操作', 'warning');
                return;
            }
            
            const lastDeleted = state.deleted.pop();
            
            // 更新UI
            updateResultList();
            updateDeletedCount();
            
            // 记录历史
            addHistory(`撤回了删除: ${lastDeleted}`);
            
            showTemporaryNotification(`已撤回删除: ${lastDeleted}`, 'success');
        }
        
        // 复制整合输出文本
        function copyIntegratedOutput() {
            if (!integratedOutput.value.trim()) {
                showTemporaryNotification('没有内容可以复制', 'warning');
                return;
            }
            
            integratedOutput.select();
            integratedOutput.setSelectionRange(0, 99999);
            
            try {
                document.execCommand('copy');
                showCopyNotification();
            } catch (err) {
                console.error('复制失败:', err);
                showTemporaryNotification('复制失败，请手动选择文本复制', 'error');
            }
        }
        
        // 显示复制成功通知
        function showCopyNotification() {
            copyNotification.classList.add('show');
            setTimeout(() => {
                copyNotification.classList.remove('show');
            }, 2000);
        }
        
        // 显示临时通知
        function showTemporaryNotification(message, type = 'info') {
            const colors = {
                success: '#2ec4b6',
                warning: '#ff9f1c',
                error: '#e63946',
                info: '#4361ee'
            };
            
            const notification = document.createElement('div');
            notification.className = 'copy-notification';
            notification.innerHTML = `<i class="fas fa-info-circle"></i> ${message}`;
            notification.style.background = colors[type];
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.add('show');
            }, 10);
            
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }
        
        // 导出整合文本
        function exportIntegratedOutput() {
            if (!integratedOutput.value.trim()) {
                showTemporaryNotification('没有内容可以导出', 'warning');
                return;
            }
            
            const content = integratedOutput.value;
            const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `主播整合名单_${new Date().toISOString().slice(0, 10)}.txt`;
            document.body.appendChild(a);
            a.click();
            
            setTimeout(() => {
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }, 100);
            
            addHistory(`导出了整合文本，共 ${parseNamesWithFormat(content).names.length} 个主播`);
        }
        
        // 导入整合文本
        function importIntegratedOutput(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const content = e.target.result;
                integratedOutput.value = content;
                updateIntegratedCount();
                
                if (confirm('是否将导入的文本同步到交互列表？')) {
                    updateListFromOutput();
                }
                
                addHistory(`导入了整合文本，共 ${parseNamesWithFormat(content).names.length} 个主播`);
                
                importOutputFile.value = '';
            };
            
            reader.readAsText(file);
        }
        
        // 导出历史记录
        function exportHistory() {
            if (state.history.length === 0) {
                showTemporaryNotification('没有历史记录可以导出', 'warning');
                return;
            }
            
            const content = state.history.map(record => 
                `[${record.date} ${record.timestamp}] ${record.action}`
            ).join('\n');
            
            const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `操作历史_${new Date().toISOString().slice(0, 10)}.txt`;
            document.body.appendChild(a);
            a.click();
            
            setTimeout(() => {
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }, 100);
        }
        
        // 检测格式
        function detectFormats() {
            const format1 = state.originalFormat1;
            const format2 = state.originalFormat2;
            
            let message = "格式检测结果:\n\n";
            
            if (format1) {
                message += "名单1格式:\n";
                message += `- 主要分隔符: ${getDelimiterName(format1.primaryDelimiter)}\n`;
                message += `- 包含换行: ${format1.hasNewline ? '是' : '否'}\n`;
                message += `- 包含中文逗号: ${format1.hasChineseComma ? '是' : '否'}\n`;
                message += `- 包含英文逗号: ${format1.hasEnglishComma ? '是' : '否'}\n`;
                message += `- 包含顿号: ${format1.hasPauseMark ? '是' : '否'}\n`;
                message += `- 使用空格分隔: ${format1.hasSpace ? '是' : '否'}\n\n`;
            }
            
            if (format2) {
                message += "名单2格式:\n";
                message += `- 主要分隔符: ${getDelimiterName(format2.primaryDelimiter)}\n`;
                message += `- 包含换行: ${format2.hasNewline ? '是' : '否'}\n`;
                message += `- 包含中文逗号: ${format2.hasChineseComma ? '是' : '否'}\n`;
                message += `- 包含英文逗号: ${format2.hasEnglishComma ? '是' : '否'}\n`;
                message += `- 包含顿号: ${format2.hasPauseMark ? '是' : '否'}\n`;
                message += `- 使用空格分隔: ${format2.hasSpace ? '是' : '否'}\n`;
            }
            
            alert(message);
            addHistory('检测了输入格式');
        }
        
        // 获取分隔符名称
        function getDelimiterName(delimiter) {
            switch(delimiter) {
                case '，': return '中文逗号';
                case ',': return '英文逗号';
                case '、': return '顿号';
                case ' ': return '空格';
                default: return delimiter;
            }
        }
        
        // 美化输出格式
        function formatOutput() {
            const result = parseNamesWithFormat(integratedOutput.value);
            
            if (result.names.length === 0) {
                showTemporaryNotification('没有内容可以美化', 'warning');
                return;
            }
            
            // 每3个名字一组，用中文逗号分隔，每组换行
            const groupSize = 3;
            let formattedText = '';
            
            for (let i = 0; i < result.names.length; i += groupSize) {
                const group = result.names.slice(i, i + groupSize);
                formattedText += group.join('，');
                if (i + groupSize < result.names.length) {
                    formattedText += '\n';
                }
            }
            
            integratedOutput.value = formattedText;
            updateIntegratedCount();
            
            addHistory(`美化了输出格式，共 ${result.names.length} 个主播`);
            showTemporaryNotification('输出文本已美化格式', 'success');
        }
        
        // 清空所有
        function clearAll() {
            if (confirm('确定要清空所有输入名单吗？')) {
                list1Input.value = '';
                list2Input.value = '';
                
                updateCounts();
                addHistory('清空了所有输入名单');
            }
        }
        
        // 清空结果列表
        function clearResults() {
            if (confirm('确定要清空交互列表吗？')) {
                state.integratedList = [];
                state.deleted = [];
                
                updateResultList();
                updateAllCounts();
                
                addHistory('清空了交互列表');
            }
        }
        
        // 清空历史记录
        function clearHistory() {
            if (confirm('确定要清空所有历史记录吗？')) {
                state.history = [];
                updateHistoryUI();
                updateHistoryCount();
                
                addHistory('清空了操作历史');
            }
        }
        
        // 初始化应用
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>